<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>тЏЙС╣ду«Ауљєу│╗у╗Ъ</title>
</head>
<body>

<h2>­ЪЊџ тЏЙС╣ду«Ауљєу│╗у╗Ъ</h2>

<button onclick="loadBooks()">ТхЈУДѕС╣ду▒Ї</button>
<button onclick="sortBooks()">ТїЅIDТјњт║Ј</button>

<hr>

<h3>уЎ╗У«░С╣ду▒Ї</h3>
<input placeholder="ID" id="id">
<input placeholder="тљЇуД░" id="name">
<input placeholder="С╗иТа╝" id="price">
<input placeholder="ТЋ░жЄЈ" id="number">
<button onclick="register()">уЎ╗У«░</button>

<hr>

<h3>тђЪ / У┐ў / ТЪЦ / тѕа</h3>
<input placeholder="С╣ду▒ЇID" id="opid">
<input placeholder="ТЋ░жЄЈ" id="count">
<button onclick="borrow()">тђЪС╣д</button>
<button onclick="ret()">У┐ўС╣д</button>
<button onclick="search()">ТЪЦТЅЙ</button>
<button onclick="del()">тѕажЎц</button>

<pre id="output"></pre>

<script>
const api = "http://127.0.0.1:5000";

function loadBooks() {
    fetch(api + "/books").then(r=>r.json()).then(d=>{
        output.textContent = JSON.stringify(d,null,2);
    });
}
function register() {
    fetch(api + "/register", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            id:id.value,
            name:name.value,
            price:+price.value,
            number:+number.value
        })
    }).then(r=>r.json()).then(alertMsg);
}
function borrow() {
    fetch(api + "/borrow", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id:opid.value,count:+count.value})
    }).then(r=>r.json()).then(alertMsg);
}
function ret() {
    fetch(api + "/return", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id:opid.value,count:+count.value})
    }).then(r=>r.json()).then(alertMsg);
}
function search() {
    fetch(api + "/search/" + opid.value)
    .then(r=>r.json()).then(d=>{
        output.textContent = JSON.stringify(d,null,2);
    });
}
function del() {
    fetch(api + "/delete/" + opid.value,{method:"DELETE"})
    .then(r=>r.json()).then(alertMsg);
}
function sortBooks() {
    fetch(api + "/sort?order=asc")
    .then(r=>r.json()).then(d=>{
        output.textContent = JSON.stringify(d,null,2);
    });
}
function alertMsg(d){ alert(d.msg); }
</script>

</body>
</html>
